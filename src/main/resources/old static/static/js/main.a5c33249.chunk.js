(this["webpackJsonptutor-me"]=this["webpackJsonptutor-me"]||[]).push([[0],{113:function(e,t){},115:function(e,t){},167:function(e,t,a){},168:function(e,t,a){"use strict";a.r(t);var n,c=a(0),i=a(24),r=a.n(i),s=a(18),l=a(193),o=a(189),d=a(186),j=a(188),b=a(169),u=a(11),p=a(46),m=a.n(p),O=a(74),g=a.n(O),f=a(75),x=a.n(f),h=a(2),v=Object(c.createContext)(),y=function(e){var t=e.children,a=Object(c.useState)(),i=Object(u.a)(a,2),r=i[0],s=i[1],l=Object(c.useState)(""),o=Object(u.a)(l,2),d=o[0],j=o[1],b=Object(c.useState)({}),p=Object(u.a)(b,2),O=p[0],f=p[1],y=Object(c.useState)({}),C=Object(u.a)(y,2),N=C[0],w=C[1],S=Object(c.useState)(!1),k=Object(u.a)(S,2),J=k[0],A=k[1],T=Object(c.useState)(!1),E=Object(u.a)(T,2),I=E[0],D=E[1],V=Object(c.useState)(""),B=Object(u.a)(V,2),R=B[0],P=B[1],U=Object(c.useState)({}),L=Object(u.a)(U,2),z=L[0],G=L[1],M=function(e){var t="; ".concat(document.cookie).split("; ".concat(e,"="));if(2===t.length)return t.pop().split(";").shift()}("user_id"),W=Object(c.useRef)(),F=Object(c.useRef)(),H=Object(c.useRef)();Object(c.useEffect)((function(){var e=new g.a("/videoCall-video");n=x.a.over(e),navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((function(e){s(e),W.current.srcObject=e})),n.connect({},_,q)}),[]);var _=function(){console.log("This is my user ID: "+M),n.subscribe("/topic/video/"+M+"/incomingCall",Y),n.subscribe("/topic/video/"+M+"/username",Q),n.subscribe("/topic/video/"+M+"/endCall",Z),n.subscribe("/topic/video/"+M+"/iceCandidates",X),n.send("/app/video.getAllUsers",{},JSON.stringify({message:M})),n.send("/app/video.iceCandidates",{},JSON.stringify({message:M}))},q=function(){console.log("Error with socket connection!")};function K(e){for(var t=0,a=Object.entries(O);t<a.length;t++){var n=Object(u.a)(a[t],2),c=n[0],i=n[1];if(c==e)return i}}var Q=function(e){console.log("This is the "+e);var t,a=JSON.parse(e.body);f(a.data);for(var n=0,c=Object.entries(a.data);n<c.length;n++){var i=Object(u.a)(c[n],2),r=i[0],s=i[1];if(r==M){t=s;break}}j(M),P(t),console.log(Object.keys(O))},X=function(e){console.log("This is the "+e);var t=JSON.parse(e.body);console.log("These are the ice candidates "+t),G(t)},Y=function(e){var t=JSON.parse(e.body);console.log("Person calling me "+t.callerName),w({isReceivedCall:!0,from:t.caller,name:t.callerName,signal:t.signal}),console.log("incoming call "+t)};var Z=function(){console.log("LEAVING THE CALL "+N.from),n.send("/app/video.endCall",{},JSON.stringify({message:N.from})),D(!0),A(!1),D(!1),w({})};return Object(h.jsx)(v.Provider,{value:{call:N,callAccepted:J,myVideo:W,userVideo:F,stream:r,name:R,setName:P,callEnded:I,me:d,users:O,callUser:function(e){var t=new m.a({initiator:!0,trickle:!1,reconnectTimer:100,iceTransportPolicy:"relay",config:{iceServers:z},stream:r});console.log("The user has been called by "+e),console.log("Message being sent: "),t.on("signal",(function(t){console.log(JSON.stringify({callee:e,caller:M,signal:t})),n.send("/app/video.callUser",{},JSON.stringify({callee:e,caller:M,signal:t}))})),t.on("stream",(function(e){F.current.srcObject=e}));n.subscribe("/topic/video/"+M+"/callAccepted",(function(a){A(!0);var n=JSON.parse(a.body);w({name:K(e),from:e}),t.signal(n.signal)})),H.current=t},leaveCall:Z,answerCall:function(){A(!0);var e=new m.a({initiator:!1,trickle:!1,stream:r,config:{iceServers:z}});e.on("signal",(function(e){n.send("/app/video.acceptCall",{},JSON.stringify({signal:e,callee:M,caller:N.from}))})),e.on("stream",(function(e){F.current.srcObject=e})),e.signal(N.signal),H.current=e}},children:t})},C=Object(d.a)((function(e){return{video:Object(s.a)({width:"550px"},e.breakpoints.down("xs"),{width:"300px"}),gridContainer:Object(s.a)({justifyContent:"center"},e.breakpoints.down("xs"),{flexDirection:"column"}),paper:{padding:"10px",border:"2px solid black",margin:"10px"}}})),N=function(){var e=Object(c.useContext)(v),t=e.name,a=e.callAccepted,n=e.myVideo,i=e.userVideo,r=e.callEnded,s=e.stream,l=e.call,d=C();return Object(h.jsxs)(j.a,{container:!0,className:d.gridContainer,children:[s&&Object(h.jsx)(b.a,{className:d.paper,children:Object(h.jsxs)(j.a,{item:!0,xs:12,md:6,children:[Object(h.jsx)(o.a,{variant:"h5",gutterBottom:!0,children:t}),Object(h.jsx)("video",{playsInline:!0,muted:!0,ref:n,autoPlay:!0,className:d.video})]})}),a&&!r&&Object(h.jsx)(b.a,{className:d.paper,children:Object(h.jsxs)(j.a,{item:!0,xs:12,md:6,children:[Object(h.jsx)(o.a,{variant:"h5",gutterBottom:!0,children:l.name}),Object(h.jsx)("video",{playsInline:!0,ref:i,autoPlay:!0,className:d.video})]})})]})},w=a(194),S=function(){var e=Object(c.useContext)(v),t=e.answerCall,a=e.call,n=e.callAccepted;return Object(h.jsx)(h.Fragment,{children:a.isReceivedCall&&!n&&Object(h.jsxs)("div",{styles:{display:"flex",justifyContent:"center"},children:[Object(h.jsxs)("h1",{children:[a.name," is calling: "]}),Object(h.jsx)(w.a,{variant:"contained",color:"primary",onClick:t,children:"Answer"})]})})},k=a(190),J=(a(163),a(191)),A=a(192),T=Object(d.a)((function(e){return{root:{display:"flex",flexDirection:"column"},gridContainer:Object(s.a)({width:"100%"},e.breakpoints.down("xs"),{flexDirection:"column"}),typography:{flexGrow:1,textAlign:"center"},container:Object(s.a)({width:"600px",margin:"35px 0",padding:0},e.breakpoints.down("xs"),{width:"80%"}),margin:{marginTop:20},padding:{padding:20},paper:{padding:"10px 20px",border:"2px solid black"}}})),E=function(e){var t=e.children,a=Object(c.useContext)(v),n=a.me,i=a.users,r=a.callAccepted,s=(a.name,a.setName,a.callEnded),l=a.leaveCall,d=a.callUser,p=Object(c.useState)(""),m=Object(u.a)(p,2),O=(m[0],m[1],T());return Object(h.jsx)(k.a,{className:O.container,children:Object(h.jsxs)(b.a,{elevation:10,className:O.paper,children:[Object(h.jsxs)("form",{className:O.root,noValidate:!0,autoComplete:"off",children:[Object(h.jsx)(j.a,{container:!0,className:O.gridContainer,children:Object(h.jsxs)(j.a,{item:!0,xs:12,md:12,className:O.padding,children:[Object(h.jsx)(o.a,{gutterBottom:!0,variant:"h6",className:O.typography,children:"Select a person to call"}),r&&!s&&Object(h.jsx)(w.a,{variant:"contained",color:"secondary",fullWidth:!0,startIcon:Object(h.jsx)(J.a,{fontSize:"large"}),onClick:l,className:O.margin,children:"End call"})]})}),Object(h.jsx)(j.a,{children:Object.entries(i).map((function(e){var t=Object(u.a)(e,2),a=t[0],c=t[1];return console.log("This is me "+a+"-"+c),a===n?null:Object(h.jsxs)(w.a,{variant:"contained",color:"primary",fullWidth:!0,startIcon:Object(h.jsx)(A.a,{fontSize:"large"}),onClick:function(){return d(a)},className:O.margin,children:["Call ",c]})}))})]}),t]})})},I=Object(d.a)((function(e){return{appBar:Object(s.a)({borderRadius:15,margin:"30px 100px",display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",width:"600px",border:"2px solid black"},e.breakpoints.down("xs"),{width:"90%"}),image:{marginLeft:"15px"},wrapper:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%"}}})),D=function(){var e=I();return Object(h.jsxs)("div",{className:e.wrapper,children:[Object(h.jsx)(l.a,{className:e.appBar,position:"static",color:"inherit",children:Object(h.jsx)(o.a,{variant:"h4",align:"center",children:"Video Call"})}),Object(h.jsx)(N,{}),Object(h.jsx)(E,{children:Object(h.jsx)(S,{})})]})};a(167);r.a.render(Object(h.jsx)(y,{children:Object(h.jsx)(D,{})}),document.getElementById("root"))}},[[168,1,2]]]);
//# sourceMappingURL=main.a5c33249.chunk.js.map