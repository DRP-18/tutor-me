(this["webpackJsonptutor-me"]=this["webpackJsonptutor-me"]||[]).push([[0],{113:function(e,t){},115:function(e,t){},167:function(e,t,n){},168:function(e,t,n){"use strict";n.r(t);var a,c=n(0),i=n(24),r=n.n(i),s=n(18),l=n(193),o=n(189),d=n(186),j=n(188),u=n(169),b=n(11),p=n(46),m=n.n(p),O=n(74),g=n.n(O),f=n(75),x=n.n(f),h=n(2),v=Object(c.createContext)(),y=function(e){var t=e.children,n=Object(c.useState)(),i=Object(b.a)(n,2),r=i[0],s=i[1],l=Object(c.useState)(""),o=Object(b.a)(l,2),d=o[0],j=o[1],u=Object(c.useState)({}),p=Object(b.a)(u,2),O=p[0],f=p[1],y=Object(c.useState)({}),C=Object(b.a)(y,2),N=C[0],w=C[1],S=Object(c.useState)(!1),k=Object(b.a)(S,2),A=k[0],J=k[1],E=Object(c.useState)(!1),I=Object(b.a)(E,2),T=I[0],D=I[1],V=Object(c.useState)(""),B=Object(b.a)(V,2),R=B[0],P=B[1],U=function(e){var t="; ".concat(document.cookie).split("; ".concat(e,"="));if(2===t.length)return t.pop().split(";").shift()}("user_id"),L=Object(c.useRef)(),z=Object(c.useRef)(),G=Object(c.useRef)();Object(c.useEffect)((function(){var e=new g.a("/videoCall-video");a=x.a.over(e),navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((function(e){s(e),L.current.srcObject=e})),a.connect({},M,W)}),[]);var M=function(){console.log("This is my user ID: "+U),a.subscribe("/topic/video/"+U+"/incomingCall",_),a.subscribe("/topic/video/"+U+"/username",H),a.subscribe("/topic/video/"+U+"/endCall",q),a.send("/app/video.getAllUsers",{},JSON.stringify({message:U}))},W=function(){console.log("Error with socket connection!")};function F(e){for(var t=0,n=Object.entries(O);t<n.length;t++){var a=Object(b.a)(n[t],2),c=a[0],i=a[1];if(c==e)return i}}var H=function(e){console.log("This is the "+e);var t,n=JSON.parse(e.body);f(n.data);for(var a=0,c=Object.entries(n.data);a<c.length;a++){var i=Object(b.a)(c[a],2),r=i[0],s=i[1];if(r==U){t=s;break}}j(U),P(t),console.log(Object.keys(O))},_=function(e){var t=JSON.parse(e.body);console.log("Person calling me "+t.callerName),w({isReceivedCall:!0,from:t.caller,name:t.callerName,signal:t.signal}),console.log("incoming call "+t)};var q=function(){console.log("LEAVING THE CALL "+N.from),a.send("/app/video.endCall",{},JSON.stringify({message:N.from})),D(!0),J(!1),D(!1),w({})};return Object(h.jsx)(v.Provider,{value:{call:N,callAccepted:A,myVideo:L,userVideo:z,stream:r,name:R,setName:P,callEnded:T,me:d,users:O,callUser:function(e){var t=new m.a({initiator:!0,trickle:!1,reconnectTimer:100,iceTransportPolicy:"relay",config:{iceServers:[{url:"stun:stun2.1.google.com:19302"}]},stream:r});console.log("The user has been called by "+e),console.log("Message being sent: "),t.on("signal",(function(t){console.log(JSON.stringify({callee:e,caller:U,signal:t})),a.send("/app/video.callUser",{},JSON.stringify({callee:e,caller:U,signal:t}))})),t.on("stream",(function(e){z.current.srcObject=e}));a.subscribe("/topic/video/"+U+"/callAccepted",(function(n){J(!0);var a=JSON.parse(n.body);w({name:F(e),from:e}),t.signal(a.signal)})),G.current=t},leaveCall:q,answerCall:function(){J(!0);var e=new m.a({initiator:!1,trickle:!1,stream:r,config:{iceServers:[{url:"stun:stun2.1.google.com:19302"}]}});e.on("signal",(function(e){a.send("/app/video.acceptCall",{},JSON.stringify({signal:e,callee:U,caller:N.from}))})),e.on("stream",(function(e){z.current.srcObject=e})),e.signal(N.signal),G.current=e}},children:t})},C=Object(d.a)((function(e){return{video:Object(s.a)({width:"550px"},e.breakpoints.down("xs"),{width:"300px"}),gridContainer:Object(s.a)({justifyContent:"center"},e.breakpoints.down("xs"),{flexDirection:"column"}),paper:{padding:"10px",border:"2px solid black",margin:"10px"}}})),N=function(){var e=Object(c.useContext)(v),t=e.name,n=e.callAccepted,a=e.myVideo,i=e.userVideo,r=e.callEnded,s=e.stream,l=e.call,d=C();return Object(h.jsxs)(j.a,{container:!0,className:d.gridContainer,children:[s&&Object(h.jsx)(u.a,{className:d.paper,children:Object(h.jsxs)(j.a,{item:!0,xs:12,md:6,children:[Object(h.jsx)(o.a,{variant:"h5",gutterBottom:!0,children:t}),Object(h.jsx)("video",{playsInline:!0,muted:!0,ref:a,autoPlay:!0,className:d.video})]})}),n&&!r&&Object(h.jsx)(u.a,{className:d.paper,children:Object(h.jsxs)(j.a,{item:!0,xs:12,md:6,children:[Object(h.jsx)(o.a,{variant:"h5",gutterBottom:!0,children:l.name}),Object(h.jsx)("video",{playsInline:!0,ref:i,autoPlay:!0,className:d.video})]})})]})},w=n(194),S=function(){var e=Object(c.useContext)(v),t=e.answerCall,n=e.call,a=e.callAccepted;return Object(h.jsx)(h.Fragment,{children:n.isReceivedCall&&!a&&Object(h.jsxs)("div",{styles:{display:"flex",justifyContent:"center"},children:[Object(h.jsxs)("h1",{children:[n.name," is calling: "]}),Object(h.jsx)(w.a,{variant:"contained",color:"primary",onClick:t,children:"Answer"})]})})},k=n(190),A=(n(163),n(191)),J=n(192),E=Object(d.a)((function(e){return{root:{display:"flex",flexDirection:"column"},gridContainer:Object(s.a)({width:"100%"},e.breakpoints.down("xs"),{flexDirection:"column"}),typography:{flexGrow:1,textAlign:"center"},container:Object(s.a)({width:"600px",margin:"35px 0",padding:0},e.breakpoints.down("xs"),{width:"80%"}),margin:{marginTop:20},padding:{padding:20},paper:{padding:"10px 20px",border:"2px solid black"}}})),I=function(e){var t=e.children,n=Object(c.useContext)(v),a=n.me,i=n.users,r=n.callAccepted,s=(n.name,n.setName,n.callEnded),l=n.leaveCall,d=n.callUser,p=Object(c.useState)(""),m=Object(b.a)(p,2),O=(m[0],m[1],E());return Object(h.jsx)(k.a,{className:O.container,children:Object(h.jsxs)(u.a,{elevation:10,className:O.paper,children:[Object(h.jsxs)("form",{className:O.root,noValidate:!0,autoComplete:"off",children:[Object(h.jsx)(j.a,{container:!0,className:O.gridContainer,children:Object(h.jsxs)(j.a,{item:!0,xs:12,md:12,className:O.padding,children:[Object(h.jsx)(o.a,{gutterBottom:!0,variant:"h6",className:O.typography,children:"Select a person to call"}),r&&!s&&Object(h.jsx)(w.a,{variant:"contained",color:"secondary",fullWidth:!0,startIcon:Object(h.jsx)(A.a,{fontSize:"large"}),onClick:l,className:O.margin,children:"End call"})]})}),Object(h.jsx)(j.a,{children:Object.entries(i).map((function(e){var t=Object(b.a)(e,2),n=t[0],c=t[1];return console.log("This is me "+n+"-"+c),n===a?null:Object(h.jsxs)(w.a,{variant:"contained",color:"primary",fullWidth:!0,startIcon:Object(h.jsx)(J.a,{fontSize:"large"}),onClick:function(){return d(n)},className:O.margin,children:["Call ",c]})}))})]}),t]})})},T=Object(d.a)((function(e){return{appBar:Object(s.a)({borderRadius:15,margin:"30px 100px",display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",width:"600px",border:"2px solid black"},e.breakpoints.down("xs"),{width:"90%"}),image:{marginLeft:"15px"},wrapper:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%"}}})),D=function(){var e=T();return Object(h.jsxs)("div",{className:e.wrapper,children:[Object(h.jsx)(l.a,{className:e.appBar,position:"static",color:"inherit",children:Object(h.jsx)(o.a,{variant:"h4",align:"center",children:"Video Call"})}),Object(h.jsx)(N,{}),Object(h.jsx)(I,{children:Object(h.jsx)(S,{})})]})};n(167);r.a.render(Object(h.jsx)(y,{children:Object(h.jsx)(D,{})}),document.getElementById("root"))}},[[168,1,2]]]);
//# sourceMappingURL=main.edb509a0.chunk.js.map